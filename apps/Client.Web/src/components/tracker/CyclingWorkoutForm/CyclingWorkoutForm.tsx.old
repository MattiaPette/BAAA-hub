import { FC, useState } from 'react';
import { Stack, TextField } from '@mui/material';
import { t } from '@lingui/core/macro';

import { CyclingWorkoutDetails } from '../../../types/tracker';
import { CyclingWorkoutFormProps } from './CyclingWorkoutForm.model';

/**
 * CyclingWorkoutForm component for detailed cycling workout tracking
 */
export const CyclingWorkoutForm: FC<CyclingWorkoutFormProps> = ({
  value,
  onChange,
}) => {
  const [distance, setDistance] = useState<number | undefined>(value?.distance);
  const [averageSpeed, setAverageSpeed] = useState<number | undefined>(
    value?.averageSpeed,
  );
  const [elevationGain, setElevationGain] = useState<number | undefined>(
    value?.elevationGain,
  );
  const [averageHeartRate, setAverageHeartRate] = useState<number | undefined>(
    value?.averageHeartRate,
  );
  const [notes, setNotes] = useState<string>(value?.notes || '');

  // Update parent when any field changes
  const updateDetails = (updates: Readonly<Partial<CyclingWorkoutDetails>>) => {
    const newDetails: CyclingWorkoutDetails = {
      distance: updates.distance ?? distance,
      averageSpeed: updates.averageSpeed ?? averageSpeed,
      elevationGain: updates.elevationGain ?? elevationGain,
      averageHeartRate: updates.averageHeartRate ?? averageHeartRate,
      notes: updates.notes ?? notes,
    };
    onChange(newDetails);
  };

  // Handle distance change
  const handleDistanceChange = (newDistance: number | undefined) => {
    setDistance(newDistance);
    updateDetails({ distance: newDistance });
  };

  // Handle average speed change
  const handleAverageSpeedChange = (newSpeed: number | undefined) => {
    setAverageSpeed(newSpeed);
    updateDetails({ averageSpeed: newSpeed });
  };

  // Handle elevation gain change
  const handleElevationGainChange = (newElevation: number | undefined) => {
    setElevationGain(newElevation);
    updateDetails({ elevationGain: newElevation });
  };

  // Handle average heart rate change
  const handleAverageHeartRateChange = (newHeartRate: number | undefined) => {
    setAverageHeartRate(newHeartRate);
    updateDetails({ averageHeartRate: newHeartRate });
  };

  // Handle notes change
  const handleNotesChange = (newNotes: string) => {
    setNotes(newNotes);
    updateDetails({ notes: newNotes });
  };

  return (
    <Stack spacing={3}>
      {/* Distance */}
      <TextField
        label={t`Distance (km)`}
        type="number"
        value={distance || ''}
        onChange={e =>
          handleDistanceChange(
            e.target.value ? Number(e.target.value) : undefined,
          )
        }
        inputProps={{ min: 0, step: 0.1 }}
        fullWidth
        placeholder={t`e.g., 25.5`}
      />

      {/* Average Speed */}
      <TextField
        label={t`Average Speed (km/h)`}
        type="number"
        value={averageSpeed || ''}
        onChange={e =>
          handleAverageSpeedChange(
            e.target.value ? Number(e.target.value) : undefined,
          )
        }
        inputProps={{ min: 0, step: 0.1 }}
        fullWidth
        placeholder={t`e.g., 28.5`}
      />

      {/* Elevation Gain */}
      <TextField
        label={t`Elevation Gain (m)`}
        type="number"
        value={elevationGain || ''}
        onChange={e =>
          handleElevationGainChange(
            e.target.value ? Number(e.target.value) : undefined,
          )
        }
        inputProps={{ min: 0, step: 1 }}
        fullWidth
        placeholder={t`e.g., 450`}
      />

      {/* Average Heart Rate */}
      <TextField
        label={t`Average Heart Rate (bpm)`}
        type="number"
        value={averageHeartRate || ''}
        onChange={e =>
          handleAverageHeartRateChange(
            e.target.value ? Number(e.target.value) : undefined,
          )
        }
        inputProps={{ min: 0, max: MAX_THEORETICAL_HEART_RATE, step: 1 }}
        fullWidth
        placeholder={t`e.g., 145`}
      />

      {/* Notes */}
      <TextField
        label={t`Notes`}
        value={notes}
        onChange={e => handleNotesChange(e.target.value)}
        multiline
        rows={3}
        fullWidth
        placeholder={t`Notes about terrain, weather, mechanical issues...`}
      />
    </Stack>
  );
};
